<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="apelade : deep pale apelade ape lap leaped" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>apelade</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/apelade">View on GitHub</a>

          <h1 id="project_title">apelade</h1>
          <h2 id="project_tagline">deep pale apelade ape lap leaped</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>Looking for these?</h3>

<p><code>npm install --recursive</code>
<code>npm update --recursive</code></p>

<p>Today I was looking at the Holowaychuk video on vimeo about modular apps.
<a href="http://vimeo.com/56166857">http://vimeo.com/56166857</a>
He showed how he thought in the project main package.json that bundledDependencies should be able to have their deps recursively installed with npm install. So I did a test to see if it's still that way, which it is as of 4/16/2013, on node 0.10.4 and npm 1.2.18</p>

<p>Looking at similar issues, there was the non-recursive nature of update, seems to be a popular issue in the npm tracker. <a href="https://github.com/isaacs/npm/issues/1341">https://github.com/isaacs/npm/issues/1341</a>
Before getting into the npm api, if ever, I wanted to do a sanity check that recursive install would not cause a probleme extraordinaire.</p>

<p>So I came up with a fs.readdr script that simply called child_process.exec. It naively recursed into node_modules so I added ignores[].
After refactoring out the npm bits, it can be used for scripting recursive execution of other programs as well</p>

<p>Usage:
<code>require("./exec_util").npm_install_rec("/dev/scratch")</code></p>

<p>File exec_util.coffee:</p>

<pre><code>###
Execute arbitrary args in a dir, singly or recursively.
A list of ignore files prevents bad recursions.
A list of target files triggers exec of args if found in the cwd.
Usage: See npm_install_rec below.
DEF_IGS works for me, but do you ever need to go to node_modules?
Paul McCulloch, 16 April 2013
License: &lt;= MIT
###

fs = require "fs"
DEF_IGS = ["node_modules", ".git"]

exec_args_in_dir = (args, dir) -&gt;
  console.log "exec", args, "in", dir
  exec = require('child_process').exec
  command = exec args, {cwd:dir, stio:"inherit"}, (err,stout,sterr) -&gt;
    console.log "\n cwd?", dir,
                "\n err?", err,
                "\n stout?", stout,
                "\n sterr?", sterr

func_walk = (args, file, parent=null, ignores=DEF_IGS, targets=[]) -&gt;
  if args? and file?
    if file in targets and parent?
      exec_args_in_dir args, parent
    else if file not in ignores
      if parent?
        file = parent + "/" + file
      fs.stat file, (err,stats) -&gt;
        console.log err if err?
        if stats.isDirectory()
          fs.readdir file, (err,files) -&gt;
            if err?
              console.log err
            else
              for item in files
                do -&gt; func_walk(args, item, file, ignores, targets)

npm_install_rec = (start) -&gt;
  func_walk "npm -s install", start, null, DEF_IGS, ["package.json"]

npm_update_rec = (start) -&gt;
  func_walk "npm -s update", start, null, DEF_IGS, ["package.json"]

module.exports = exports =
  func_walk: func_walk
  exec_args_dir: exec_args_in_dir
  npm_install_rec: npm_install_rec
  npm_update_rec: npm_update_rec
</code></pre>

<p>Could be useful for an installer if npm is not the way to go and shrinkwrap doesn't do it.
The problem for the Holowaychuk scenario is that it's not just npm install anymore, it's Cakefile requires exec_util or whatever. Works on win7-64.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>



  </body>
</html>
